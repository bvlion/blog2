<!doctype html><html lang=ja-jp><head><title>XServer にデプロイした Slim のアプリで Authorization を取得する | 鰯の管詰</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><link rel=canonical href=https://www.ambitious-i.net/blog/slim4_on_xservers_nginx/><link rel=apple-touch-icon sizes=180x180 href=https://www.ambitious-i.net/image/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.ambitious-i.net/image/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.ambitious-i.net/image/favicons/favicon-16x16.png><link rel=manifest href=https://www.ambitious-i.net/image/favicons/site.webmanifest><link rel=mask-icon href=https://www.ambitious-i.net/image/favicons/safari-pinned-tab.svg color=#999999><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta name=description content="
    XServer にデプロイした Slim FW で作ったアプリで Authorization が取得できなかった時の解決策を記事にしました！
    "><meta property="og:description" content="
    XServer にデプロイした Slim FW で作ったアプリで Authorization が取得できなかった時の解決策を記事にしました！
    "><meta property="og:image" content="https://github.com/bvlion/blog2/assets/24517539/dcb05741-c42d-43e4-a1a8-7be747b05f26"><meta property="og:title" content="XServer にデプロイした Slim のアプリで Authorization を取得する"><meta property="og:type" content="article"><meta property="og:url" content="https://www.ambitious-i.net/blog/slim4_on_xservers_nginx/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-03-10T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-10T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="XServer にデプロイした Slim のアプリで Authorization を取得する"><meta name=twitter:description content="XServer にデプロイした Slim FW で作ったアプリで Authorization が取得できなかった時の解決策を記事にしました！"><meta itemprop=name content="XServer にデプロイした Slim のアプリで Authorization を取得する"><meta itemprop=description content="XServer にデプロイした Slim FW で作ったアプリで Authorization が取得できなかった時の解決策を記事にしました！"><meta itemprop=datePublished content="2024-03-10T00:00:00+00:00"><meta itemprop=dateModified content="2024-03-10T00:00:00+00:00"><meta itemprop=wordCount content="103"><meta itemprop=keywords content="技術,PHP"><link rel=stylesheet href=https://www.ambitious-i.net/main.min.css><script src=https://www.ambitious-i.net/bundle.js></script></head><body><header id=header><div class=top-bar><div class=container-md><div class="row align-items-center"><div class="col-3 col-sm-4 social-buttons d-none d-sm-block"><ul><li><a href=https://x.com/ninjinx target=_blank><i class="fab fa-twitter"></i></a></li><li><a href=https://github.com/bvlion target=_blank><i class="fab fa-github"></i></a></li></ul></div><div class="ra-toggler col-3 col-sm-4 d-block d-sm-none"><button class=bg-dark type=button data-bs-toggle=collapse data-bs-target=#navbarNav>
<i class="fas fa-bars"></i></button></div><div class="col-6 col-sm-4"><h2 class=title><a href=https://www.ambitious-i.net/>鰯の管詰</a></h2></div><div class="col-3 col-sm-4"><div class="col col-md-8 offset-md-4 d-none d-sm-block"><form id=cse-search-box-form-id class="input-group search-bar" onsubmit=return!1 role=search><input id=cse-search-input-box-id2 type=text class=form-control placeholder=Search onkeyup=handleKeyPress(event)>
<button class=btn type=submit onclick=searchBlog()>
<i class="fa fa-search"></i></button></form></div></div></div></div></div><div class=container-md><nav class="navbar navbar-expand-sm navbar-dark bg-dark"><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav mx-auto"><li class="nav-item d-block d-sm-none"><ul class=social-buttons><ul><li><a href=https://x.com/ninjinx target=_blank><i class="fab fa-twitter"></i></a></li><li><a href=https://github.com/bvlion target=_blank><i class="fab fa-github"></i></a></li></ul></ul></li><li class=nav-item><a class=nav-link href=https://www.ambitious-i.net/>Home</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown>Blog</a><div class=dropdown-menu><a class=dropdown-item href=https://www.ambitious-i.net/blog/>記事一覧</a>
<a class=dropdown-item href=https://www.ambitious-i.net/tags/>タグ</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-bs-toggle=dropdown>About</a><div class=dropdown-menu><a class=dropdown-item href=https://www.ambitious-i.net/person/>本人について</a>
<a class=dropdown-item href=https://www.ambitious-i.net/account/>アカウント</a>
<a class=dropdown-item target=_blank href=https://bvlion-app.web.app>個人活動</a></div></li><li class=nav-item><a class=nav-link target=_blank href=https://forms.gle/dUkf1dNdkgN2ZxJ66>ご意見・ご感想</a></li></ul><form id=cse-search-box-form-id2 class="d-flex search-bar d-block d-sm-none" onsubmit=return!1 role=search><input id=cse-search-input-box-id2 type=text class=form-control placeholder=Search onkeyup=handleKeyPress(event)>
<button class=btn type=submit onclick=searchBlog()>
<i class="fa fa-search"></i></button></form></div></nav></div></header><main class=blog-content><div class=container-md><div class=row><div class="col-md-12 col-lg-12 px-lg-4"><h1 class=title>XServer にデプロイした Slim のアプリで Authorization を取得する</h1><div class="container-fluid px-0 mb-4"><div class="row align-items-end"><div class="col-md-4 date-time"><span class=date>2024/3/10
</span>&#183;
<span class=time-to-read>5 mins read</span></div><div class="col-md-8 tags"><a href=https://www.ambitious-i.net/tags/%E6%8A%80%E8%A1%93><span class="tag bg-dark">技術</span></a>
<a href=https://www.ambitious-i.net/tags/php><span class="tag bg-dark">PHP</span></a></div></div></div><figure><img id=cover-image src=https://github.com/bvlion/blog2/assets/24517539/dcb05741-c42d-43e4-a1a8-7be747b05f26 alt="XServer にデプロイした Slim のアプリで Authorization を取得する"></figure><p>個人アプリのサーバー側を Slim4 に移行しました！<br>その際 Authorization が取れず四苦八苦した記録です…</p><h2 id=経緯>経緯</h2><p>個人で<a href="https://play.google.com/store/apps/details?id=net.ambitious.daigoapp.android&amp;pli=1">略語Generator</a>なるアプリを作ってリリースしています(･∀･)<br>元々は Kuromoji を Kotlin から使って形態素解析ができ、いい感じにアルファベットにもできたのでアプリにしようと思ったんですが、これが辞書もあるためなかなかの大サイズ…<br>APK ファイルが大きすぎるのを防ぐべく、解析はサーバー側ですべく一旦 <a href=https://github.com/bvlion/DAIgoAPI>API という形</a>で GCP に置いてリリースまで実施しました！</p><p>そのまままぁまぁな期間運用していたのですが、最近自社の SRE でも料金見直しを実施していて、自身のサーバー系でもコストでカットできる箇所はないかな〜と思っていたところ、この API が見つかりました(^^;<br>別にこの程度のアプリは GCP である必要もないし、XServer にリリースすれば十分そうなので、PHP に書き換えて MeCab を利用することにしました！</p><p>MeCab を Xserver にインストールする方法はググれば出てくるので割愛するとして、PHP の FW は Slim4 にしました！<br>元々 Kotlin の API でも Ktor を使っていたので、同じく軽量なフレームワークを利用しようという感じです(๑•̀ㅂ•́)و✧</p><h2 id=デプロイしたらエラー>デプロイしたらエラー…</h2><p>ローカルでは問題なくアプリとも接続できたので、いざデプロイ！…してみると認証が通らない(T_T)<br>当初は MiddleWare で Authorization ヘッダーをチェックしていたので、もしかしてそれ？とも思い実装を変えてみるも違う…<br>というか <code>$_SERVER</code> には当然ないし、<code>apache_request_headers()</code> にも <code>getallheaders()</code> にもない(>_&lt;)</p><p>あれこれやってみるも手詰まりになり「そもそも XServer で取れないのか？」などとワケの分からんことを思い始めていた時、ふと思い出しました。<br><a href=https://github.com/bvlion/holidays-webhook-server>holidays-webhook-server</a> は取れているということは、何か設定が…？<br>探してみるとありました(^^;</p><h2 id=必要なのは-publichtaccess-の設定>必要なのは public/.htaccess の設定</h2><p><code>public/.htaccess</code> に以下の追記が必要でした…</p><pre tabindex=0><code># Handle Authorization Header
RewriteCond %{HTTP:Authorization} .
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</code></pre><p>そうです、XServer は Nginx なので FastCGI となるため、そのまま <code>getallheaders()</code> などでは取得できないので、Authorization を環境変数に代入してから取得するんですね！<br>（解釈が違いそうでしたツッコミコメントお待ちしております）<br>Laravel は Skeleton に最初から入っていたので全く気づけませんでした…</p><h2 id=今後>今後</h2><p>ということで完成したのが <a href=https://github.com/bvlion/DAIgoAPI2>DAIgoAPI2</a> ですw<br>何か新機能をリリースするようなことがあるアプリでもないので、のんびりライブラリや SDK のアップデートなんかをしていこうと思います(*･ω･)ﾉ</p><div id=social-media-share><div class=share-buttons><a href="https://twitter.com/intent/tweet?text=XServer%20%e3%81%ab%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4%e3%81%97%e3%81%9f%20Slim%20%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%81%a7%20Authorization%20%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b&url=https%3a%2f%2fwww.ambitious-i.net%2fblog%2fslim4_on_xservers_nginx%2f" onclick='return socialMediaPopUp(this.href,"",500,500),!1' title="Share on Twitter. Opens in a new window."><img src=https://www.ambitious-i.net/icons/45px/twitter-x.png>
</a><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.ambitious-i.net%2fblog%2fslim4_on_xservers_nginx%2f" onclick='return socialMediaPopUp(this.href,"",500,500),!1' title="Share on Facebook. Opens in a new window."><img src=https://www.ambitious-i.net/icons/45px/facebook.png>
</a><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fwww.ambitious-i.net%2fblog%2fslim4_on_xservers_nginx%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on Pinterest. Opens in a new window."><img src=https://www.ambitious-i.net/icons/45px/pinterest.png>
</a><a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.ambitious-i.net%2fblog%2fslim4_on_xservers_nginx%2f
			&title=XServer%20%e3%81%ab%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4%e3%81%97%e3%81%9f%20Slim%20%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%81%a7%20Authorization%20%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b&summary=%3cp%3e%e5%80%8b%e4%ba%ba%e3%82%a2%e3%83%97%e3%83%aa%e3%81%ae%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e5%81%b4%e3%82%92%20Slim4%20%e3%81%ab%e7%a7%bb%e8%a1%8c%e3%81%97%e3%81%be%e3%81%97%e3%81%9f%ef%bc%81%3cbr%3e%0a%e3%81%9d%e3%81%ae%e9%9a%9b%20Authorization%20%e3%81%8c%e5%8f%96%e3%82%8c%e3%81%9a%e5%9b%9b%e8%8b%a6%e5%85%ab%e8%8b%a6%e3%81%97%e3%81%9f%e8%a8%98%e9%8c%b2%e3%81%a7%e3%81%99%e2%80%a6%3c%2fp%3e%0a%3ch2%20id%3d%22%e7%b5%8c%e7%b7%af%22%3e%e7%b5%8c%e7%b7%af%3c%2fh2%3e%0a%3cp%3e%e5%80%8b%e4%ba%ba%e3%81%a7%3ca%20href%3d%22https%3a%2f%2fplay.google.com%2fstore%2fapps%2fdetails%3fid%3dnet.ambitious.daigoapp.android%26amp%3bpli%3d1%22%3e%e7%95%a5%e8%aa%9eGenerator%3c%2fa%3e%e3%81%aa%e3%82%8b%e3%82%a2%e3%83%97%e3%83%aa%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%a6%e3%83%aa%e3%83%aa%e3%83%bc%e3%82%b9%e3%81%97%e3%81%a6%e3%81%84%e3%81%be%e3%81%99%28%ef%bd%a5%e2%88%80%ef%bd%a5%29%3cbr%3e%0a%e5%85%83%e3%80%85%e3%81%af%20Kuromoji%20%e3%82%92%20Kotlin%20%e3%81%8b%e3%82%89%e4%bd%bf%e3%81%a3%e3%81%a6%e5%bd%a2%e6%85%8b%e7%b4%a0%e8%a7%a3%e6%9e%90%e3%81%8c%e3%81%a7%e3%81%8d%e3%80%81%e3%81%84%e3%81%84%e6%84%9f%e3%81%98%e3%81%ab%e3%82%a2%e3%83%ab%e3%83%95%e3%82%a1%e3%83%99%e3%83%83%e3%83%88%e3%81%ab%e3%82%82%e3%81%a7%e3%81%8d%e3%81%9f%e3%81%ae%e3%81%a7%e3%82%a2%e3%83%97%e3%83%aa%e3%81%ab%e3%81%97%e3%82%88%e3%81%86%e3%81%a8%e6%80%9d%e3%81%a3%e3%81%9f%e3%82%93%e3%81%a7%e3%81%99%e3%81%8c%e3%80%81%e3%81%93%e3%82%8c%e3%81%8c%e8%be%9e%e6%9b%b8%e3%82%82%e3%81%82%e3%82%8b%e3%81%9f%e3%82%81%e3%81%aa%e3%81%8b%e3%81%aa%e3%81%8b%e3%81%ae%e5%a4%a7%e3%82%b5%e3%82%a4%e3%82%ba%e2%80%a6%3cbr%3e%0aAPK%20%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%8c%e5%a4%a7%e3%81%8d%e3%81%99%e3%81%8e%e3%82%8b%e3%81%ae%e3%82%92%e9%98%b2%e3%81%90%e3%81%b9%e3%81%8f%e3%80%81%e8%a7%a3%e6%9e%90%e3%81%af%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e5%81%b4%e3%81%a7%e3%81%99%e3%81%b9%e3%81%8f%e4%b8%80%e6%97%a6%20%3ca%20href%3d%22https%3a%2f%2fgithub.com%2fbvlion%2fDAIgoAPI%22%3eAPI%20%e3%81%a8%e3%81%84%e3%81%86%e5%bd%a2%3c%2fa%3e%e3%81%a7%20GCP%20%e3%81%ab%e7%bd%ae%e3%81%84%e3%81%a6%e3%83%aa%e3%83%aa%e3%83%bc%e3%82%b9%e3%81%be%e3%81%a7%e5%ae%9f%e6%96%bd%e3%81%97%e3%81%be%e3%81%97%e3%81%9f%ef%bc%81%3c%2fp%3e%0a%3cp%3e%e3%81%9d%e3%81%ae%e3%81%be%e3%81%be%e3%81%be%e3%81%81%e3%81%be%e3%81%81%e3%81%aa%e6%9c%9f%e9%96%93%e9%81%8b%e7%94%a8%e3%81%97%e3%81%a6%e3%81%84%e3%81%9f%e3%81%ae%e3%81%a7%e3%81%99%e3%81%8c%e3%80%81%e6%9c%80%e8%bf%91%e8%87%aa%e7%a4%be%e3%81%ae%20SRE%20%e3%81%a7%e3%82%82%e6%96%99%e9%87%91%e8%a6%8b%e7%9b%b4%e3%81%97%e3%82%92%e5%ae%9f%e6%96%bd%e3%81%97%e3%81%a6%e3%81%84%e3%81%a6%e3%80%81%e8%87%aa%e8%ba%ab%e3%81%ae%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e7%b3%bb%e3%81%a7%e3%82%82%e3%82%b3%e3%82%b9%e3%83%88%e3%81%a7%e3%82%ab%e3%83%83%e3%83%88%e3%81%a7%e3%81%8d%e3%82%8b%e7%ae%87%e6%89%80%e3%81%af%e3%81%aa%e3%81%84%e3%81%8b%e3%81%aa%e3%80%9c%e3%81%a8%e6%80%9d%e3%81%a3%e3%81%a6%e3%81%84%e3%81%9f%e3%81%a8%e3%81%93%e3%82%8d%e3%80%81%e3%81%93%e3%81%ae%20API%20%e3%81%8c%e8%a6%8b%e3%81%a4%e3%81%8b%e3%82%8a%e3%81%be%e3%81%97%e3%81%9f%28%5e%5e%3b%3cbr%3e%0a%e5%88%a5%e3%81%ab%e3%81%93%e3%81%ae%e7%a8%8b%e5%ba%a6%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%81%af%20GCP%20%e3%81%a7%e3%81%82%e3%82%8b%e5%bf%85%e8%a6%81%e3%82%82%e3%81%aa%e3%81%84%e3%81%97%e3%80%81XServer%20%e3%81%ab%e3%83%aa%e3%83%aa%e3%83%bc%e3%82%b9%e3%81%99%e3%82%8c%e3%81%b0%e5%8d%81%e5%88%86%e3%81%9d%e3%81%86%e3%81%aa%e3%81%ae%e3%81%a7%e3%80%81PHP%20%e3%81%ab%e6%9b%b8%e3%81%8d%e6%8f%9b%e3%81%88%e3%81%a6%20MeCab%20%e3%82%92%e5%88%a9%e7%94%a8%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%81%ab%e3%81%97%e3%81%be%e3%81%97%e3%81%9f%ef%bc%81%3c%2fp%3e&source=https%3a%2f%2fwww.ambitious-i.net%2f" onclick='return socialMediaPopUp(this.href,"",900,500),!1' title="Share on LinkedIn. Opens in a new window."><img src=https://www.ambitious-i.net/icons/45px/linkedin.png>
</a><a href="mailto:?subject=XServer%20%e3%81%ab%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4%e3%81%97%e3%81%9f%20Slim%20%e3%81%ae%e3%82%a2%e3%83%97%e3%83%aa%e3%81%a7%20Authorization%20%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b&amp;body=Check out this site https%3a%2f%2fwww.ambitious-i.net%2fblog%2fslim4_on_xservers_nginx%2f" title="Share via Email. Opens in a new window."><img src=https://www.ambitious-i.net/icons/45px/mail.png></a></div></div></div></div></div></main><footer class="text-center py-4"><p>鰯の管詰 © 2017 bvlion. All rights reserved.</p></footer><script async src="https://cse.google.com/cse.js?cx=google-cse-key"></script><gcse:searchresults-only></gcse:searchresults-only></body></html>